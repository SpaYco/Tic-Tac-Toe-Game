#!/usr/bin/env ruby
# rubocop:disable Style/GlobalVars, Layout/LineLength, Metrics/MethodLength, Metrics/CyclomaticComplexity, Metrics/PerceivedComplexity
class Game
  def initialize(player1, player2)
    @player1 = player1
    @player2 = player2
    start
  end

  def restart
    start
  end

  def start
    $moves = {
      'a1' => 'a1',
      'a2' => 'a2',
      'a3' => 'a3',
      'b1' => 'b1',
      'b2' => 'b2',
      'b3' => 'b3',
      'c1' => 'c1',
      'c2' => 'c2',
      'c3' => 'c3'
    }
    $moves_played = 0
    puts "Welcome #{@player1} and #{@player2}"
    puts "Let's start the game"
    puts "Here's your current board"
    puts '----------'
    puts "|#{$moves['a1']}|#{$moves['a2']}|#{$moves['a3']}|"
    puts '----------'
    puts "|#{$moves['b1']}|#{$moves['b2']}|#{$moves['b3']}|"
    puts '----------'
    puts "|#{$moves['c1']}|#{$moves['c2']}|#{$moves['c3']}|"
    puts '----------'
    current_player = @player1
    $game_over = false
    while $game_over == false
      print "#{current_player} enter your move : "
      current_move = gets.chomp
      add(current_player, current_move)
      $moves_played += 1 if $possible == true
      if check == true
        puts "congrats #{current_player}, you've won the game after #{$moves_played} moves"
        break
      elsif check == 'tie'
        puts "game over, it's a tie!"
        break
      elsif $possible == true
        puts 'great move!'
      end
      current_player = current_player == @player1 ? @player2 : @player1 if $possible == true
    end
    print 'would you like to play another game? (y/n) : '
    answer = gets.chomp
    answer == 'y' ? restart : (puts 'see you next time, goodbye!')
  end

  private

  def add(player, move)
    $possible = true
    $possible = false if $moves[move] == 'X' || $moves[move] == 'O' || $moves.key?(move) == false
    if $possible == true
      $moves[move] = 'X' if player == @player1
      $moves[move] = 'O' if player == @player2
    end
    puts "Here's your current board"
    puts '----------'
    puts "|#{$moves['a1']}|#{$moves['a2']}|#{$moves['a3']}|"
    puts '----------'
    puts "|#{$moves['b1']}|#{$moves['b2']}|#{$moves['b3']}|"
    puts '----------'
    puts "|#{$moves['c1']}|#{$moves['c2']}|#{$moves['c3']}|"
    puts '----------'
    puts 'Please enter a valid move' if $possible == false
  end

  def check
    win = [[$moves['a1'], $moves['a2'], $moves['a3']], [$moves['b1'], $moves['b2'], $moves['b3']], [$moves['c1'], $moves['c2'], $moves['c3']], [$moves['a1'], $moves['b1'], $moves['c1']], [$moves['a2'], $moves['b2'], $moves['c2']], [$moves['a3'], $moves['b3'], $moves['c3']], [$moves['a1'], $moves['b2'], $moves['c3']], [$moves['a3'], $moves['b2'], $moves['c1']]]
    status = false
    if $moves_played < 9
      win.each do |k|
        status = true if k.all? { |v| v == 'X' }
        status = true if k.all? { |v| v == 'O' }
      end
    else
      status = 'tie'
    end
    status
  end
end
# rubocop:enable Style/GlobalVars, Layout/LineLength, Metrics/MethodLength, Metrics/CyclomaticComplexity, Metrics/PerceivedComplexity
print 'Player1 enter your name: '
input1 = gets.chomp
print 'Player2 enter your name: '
input2 = gets.chomp

Game.new(input1, input2)
